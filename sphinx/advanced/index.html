
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://advancehs.github.io/pyStoNED2/sphinx/advanced/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Advanced topics - addana</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#advanced-topics" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="addana" class="md-header__button md-logo" aria-label="addana" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            addana
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Advanced topics
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/advancehs/pyStoNED2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="addana" class="md-nav__button md-logo" aria-label="addana" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    addana
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/advancehs/pyStoNED2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        Usage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        FAQ
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/advancehs/pyStoNED2/issues" class="md-nav__link">
        Report Issues
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pyStoNED2/" class="md-nav__link">
        pyStoNED2 module
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#removing-the-constraint-on-beta" class="md-nav__link">
    Removing the constraint on Beta
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#adding-an-additional-constraint" class="md-nav__link">
    Adding an additional constraint
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#miscellaneous" class="md-nav__link">
    Miscellaneous
  </a>
  
    <nav class="md-nav" aria-label="Miscellaneous">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gams2python" class="md-nav__link">
    gams2python
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cnls_concretemodel" class="md-nav__link">
    CNLS_ConcreteModel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dea_concretemodel" class="md-nav__link">
    DEA_ConcreteModel
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  

  <a href="https://github.com/advancehs/pyStoNED2/edit/master/docs/sphinx/advanced/index.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


<h1 id="advanced-topics">Advanced topics<a class="headerlink" href="#advanced-topics" title="Permanent link">&para;</a></h1>
<h2 id="removing-the-constraint-on-beta">Removing the constraint on Beta<a class="headerlink" href="#removing-the-constraint-on-beta" title="Permanent link">&para;</a></h2>
<p>We can remove the constrinat on Beta by adding <code>model.__model__.beta.setlb(None)</code> before the model optimization (i.e., <code>model.optimize()</code>). Now the estimated Beta can take any value in Reals. For example, the constraint Beta &gt;= 0 is removed in CQR:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># import packages</span>
<span class="kn">from</span> <span class="nn">pystoned</span> <span class="kn">import</span> <span class="n">CQER</span>
<span class="kn">from</span> <span class="nn">pystoned.constant</span> <span class="kn">import</span> <span class="n">CET_ADDI</span><span class="p">,</span> <span class="n">FUN_PROD</span><span class="p">,</span> <span class="n">OPT_LOCAL</span><span class="p">,</span> <span class="n">RTS_VRS</span>
<span class="kn">from</span> <span class="nn">pystoned</span> <span class="kn">import</span> <span class="n">dataset</span> <span class="k">as</span> <span class="n">dataset</span>

<span class="c1"># import the GHG example data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">load_GHG_abatement_cost</span><span class="p">(</span><span class="n">x_select</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HRSN&#39;</span><span class="p">,</span> <span class="s1">&#39;CPNK&#39;</span><span class="p">,</span> <span class="s1">&#39;GHG&#39;</span><span class="p">],</span> <span class="n">y_select</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VALK&#39;</span><span class="p">])</span>

<span class="c1"># calculate the quantile model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">CQER</span><span class="o">.</span><span class="n">CQR</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cet</span><span class="o">=</span><span class="n">CET_ADDI</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">FUN_PROD</span><span class="p">,</span> <span class="n">rts</span><span class="o">=</span><span class="n">RTS_VRS</span><span class="p">)</span>
<span class="c1"># remove the constraint beta &gt;= 0</span>
<span class="n">model</span><span class="o">.</span><span class="n">__model__</span><span class="o">.</span><span class="n">beta</span><span class="o">.</span><span class="n">setlb</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">OPT_LOCAL</span><span class="p">)</span>

<span class="c1"># display estimated beta</span>
<span class="n">model</span><span class="o">.</span><span class="n">display_beta</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h2 id="adding-an-additional-constraint">Adding an additional constraint<a class="headerlink" href="#adding-an-additional-constraint" title="Permanent link">&para;</a></h2>
<p>The extral constraint, e.g., 0 &lt;= Beta &lt;= 1, can be added using</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">Constraint</span>

<span class="k">def</span> <span class="nf">constraint_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="n">upperbound</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">upperbound</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

<span class="n">res</span><span class="o">.</span><span class="n">__model__</span><span class="o">.</span><span class="n">beta_constraint_rule</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">__model__</span><span class="o">.</span><span class="n">I</span><span class="p">,</span>
                                                <span class="n">res</span><span class="o">.</span><span class="n">__model__</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                                                <span class="n">rule</span><span class="o">=</span><span class="n">constraint_rule</span><span class="p">,</span>
                                                <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;beta constraint&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
<p>A simple CQR example:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># import packages</span>
<span class="kn">from</span> <span class="nn">pystoned</span> <span class="kn">import</span> <span class="n">CQER</span>
<span class="kn">from</span> <span class="nn">pystoned.constant</span> <span class="kn">import</span> <span class="n">CET_ADDI</span><span class="p">,</span> <span class="n">FUN_PROD</span><span class="p">,</span> <span class="n">OPT_LOCAL</span><span class="p">,</span> <span class="n">RTS_VRS</span>
<span class="kn">from</span> <span class="nn">pystoned</span> <span class="kn">import</span> <span class="n">dataset</span> <span class="k">as</span> <span class="n">dataset</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="n">Constraint</span>

<span class="c1"># import the GHG example data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">load_GHG_abatement_cost</span><span class="p">(</span><span class="n">x_select</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HRSN&#39;</span><span class="p">,</span> <span class="s1">&#39;CPNK&#39;</span><span class="p">,</span> <span class="s1">&#39;GHG&#39;</span><span class="p">],</span> <span class="n">y_select</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;VALK&#39;</span><span class="p">])</span>

<span class="c1"># calculate the quantile model</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">CQER</span><span class="o">.</span><span class="n">CQR</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">tau</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cet</span><span class="o">=</span><span class="n">CET_ADDI</span><span class="p">,</span> <span class="n">fun</span><span class="o">=</span><span class="n">FUN_PROD</span><span class="p">,</span> <span class="n">rts</span><span class="o">=</span><span class="n">RTS_VRS</span><span class="p">)</span>
<span class="c1"># add an extral constraint on beta</span>
<span class="k">def</span> <span class="nf">constraint_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="n">upperbound</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">upperbound</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

<span class="n">res</span><span class="o">.</span><span class="n">__model__</span><span class="o">.</span><span class="n">beta_constraint_rule</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">__model__</span><span class="o">.</span><span class="n">I</span><span class="p">,</span>
                                                <span class="n">res</span><span class="o">.</span><span class="n">__model__</span><span class="o">.</span><span class="n">J</span><span class="p">,</span>
                                                <span class="n">rule</span><span class="o">=</span><span class="n">constraint_rule</span><span class="p">,</span>
                                                <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;beta constraint&#39;</span><span class="p">)</span>
<span class="n">res</span><span class="o">.</span><span class="n">optimize</span><span class="p">(</span><span class="n">OPT_LOCAL</span><span class="p">)</span>

<span class="c1"># display estimated beta</span>
<span class="n">res</span><span class="o">.</span><span class="n">display_beta</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<h2 id="miscellaneous">Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permanent link">&para;</a></h2>
<h3 id="gams2python">gams2python<a class="headerlink" href="#gams2python" title="Permanent link">&para;</a></h3>
<p><a href="http://www.pyomo.org/">pyomo</a> provides a good coding environment that can help us smoothly transfer
from GAMS to Python. Thus, we prepare a short tutorial to help GAMSers to understand how to rewrite 
the CNLS models, even other complicated models on Python.</p>
<p><a href="https://colab.research.google.com/github/ds2010/pyStoNED/blob/master/notebooks/gams2python.ipynb">A short comparison</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1">### We first present the GAMS code,</span>
<span class="c1">#sets </span>
<span class="c1">#     i        &quot;DMU&#39;s&quot;  /1*10/</span>
<span class="c1">#     j        &#39;outputs&#39; /Energy, Length, Customers/;</span>

<span class="c1">### then the Python code is added to compare.</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;CNLS&quot;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i1&#39;</span><span class="p">,</span> <span class="s1">&#39;i2&#39;</span><span class="p">,</span> <span class="s1">&#39;i3&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span> <span class="s1">&#39;i5&#39;</span><span class="p">,</span> <span class="s1">&#39;i6&#39;</span><span class="p">,</span><span class="s1">&#39;i7&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span> <span class="s1">&#39;i9&#39;</span><span class="p">,</span><span class="s1">&#39;i10&#39;</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;DMUS&#39;</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;outputs&#39;</span><span class="p">)</span>

<span class="c1"># alias(i,h); </span>

<span class="n">model</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">SetOf</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>

<span class="c1">#Table data(i,j)</span>
<span class="c1">#$Include energy.txt;</span>

<span class="n">dtab</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;i1&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">75</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i1&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">878</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i1&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">4933</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i2&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">62</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i2&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">964</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i2&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">6149</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i3&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">78</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i3&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">676</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i3&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">6098</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">683</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">12522</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i4&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">55226</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i5&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">27</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i5&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">697</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i5&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">1670</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i6&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">295</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i6&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">953</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i6&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">22949</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i7&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">44</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i7&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">917</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i7&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">3599</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">171</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">1580</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i8&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">11081</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i9&#39;</span><span class="p">,</span>  <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">98</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i9&#39;</span><span class="p">,</span>  <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">116</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i9&#39;</span><span class="p">,</span>  <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">377</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i10&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">203</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i10&#39;</span><span class="p">,</span> <span class="s1">&#39;Length&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="mi">740</span><span class="p">,</span>
        <span class="p">(</span><span class="s1">&#39;i10&#39;</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">):</span> <span class="mi">10134</span><span class="p">,</span>
        <span class="p">}</span>
<span class="n">model</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">dtab</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;output data&#39;</span><span class="p">)</span>

<span class="c1">#PARAMETERS</span>
<span class="c1">#c(i)         &quot;Total cost of firm i&quot;</span>
<span class="c1">#y(i,j)       &quot;Output j of firm i&quot;;</span>
<span class="n">model</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;i1&#39;</span><span class="p">:</span> <span class="mi">1612</span><span class="p">,</span>
                                     <span class="s1">&#39;i2&#39;</span><span class="p">:</span> <span class="mi">1659</span><span class="p">,</span>
                                     <span class="s1">&#39;i3&#39;</span><span class="p">:</span> <span class="mi">1708</span><span class="p">,</span>
                                     <span class="s1">&#39;i4&#39;</span><span class="p">:</span> <span class="mi">18918</span><span class="p">,</span>
                                     <span class="s1">&#39;i5&#39;</span><span class="p">:</span> <span class="mi">1167</span><span class="p">,</span>
                                     <span class="s1">&#39;i6&#39;</span><span class="p">:</span> <span class="mi">3395</span><span class="p">,</span>
                                     <span class="s1">&#39;i7&#39;</span><span class="p">:</span> <span class="mi">1333</span><span class="p">,</span>
                                     <span class="s1">&#39;i8&#39;</span><span class="p">:</span> <span class="mi">3518</span><span class="p">,</span>
                                     <span class="s1">&#39;i9&#39;</span><span class="p">:</span> <span class="mi">1415</span><span class="p">,</span>
                                     <span class="s1">&#39;i10&#39;</span><span class="p">:</span><span class="mi">2469</span><span class="p">,</span>
                                    <span class="p">},</span> 
                      <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Cost data&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">y_init</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">return</span>  <span class="n">model</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">y_init</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;output data&#39;</span><span class="p">)</span>

<span class="c1">#VARIABLES</span>
<span class="c1">#E(i)            &quot;Composite error term (v + u)&quot;</span>
<span class="c1">#SSE             &quot;Sum of squares of residuals&quot;;</span>
<span class="c1">#POSITIVE VARIABLES</span>
<span class="c1">#b(i,j)    &quot;Beta-coefficients (positivity ensures monotonicity)&quot;</span>
<span class="c1">#Chat(i)  ;</span>

<span class="n">model</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;beta-coeff&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;res&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;frontier&#39;</span><span class="p">)</span>

<span class="c1">#Equations</span>
<span class="c1">#QSSE                  objective function = sum of squares of residuals</span>
<span class="c1">#QREGRESSION(i)        log-transformed regression equation</span>
<span class="c1">#Qlog(i)               supporting hyperplanes of the nonparametric cost function</span>
<span class="c1">#QCONC(i,h)            concavity constraint (Afriat inequalities);</span>

<span class="c1">#QSSE..                SSE=e=sum(i,E(i)*E(i)) ;</span>
<span class="c1">#QREGRESSION(i)..      log(C(i)) =e= log(Chat(i) + 1) + E(i);</span>
<span class="c1">#Qlog(i)..             Chat(i) =e= sum(j, b(i,j)*Y(i,j)) - 1;</span>
<span class="c1">#QCONC(i,h)..          sum(j, b(i,j)*Y(i,j)) =g= sum(j, b(h,j)*Y(i,j));</span>

<span class="k">def</span> <span class="nf">objective_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">objective_rule</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;objective function&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">qreg_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">log</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">log</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">qreg</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">qreg_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;log-transformed regression&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">qlog_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">model</span><span class="o">.</span><span class="n">qlog</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">qlog_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;cost function&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">qconvex_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">qconvex</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">qconvex_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;convexity constraint&#39;</span><span class="p">)</span>

<span class="c1"># Execute the model</span>
<span class="c1">#MODEL StoNED /all/;</span>
<span class="c1">#SOLVE StoNED using NLP Minimizing SSE;</span>

<span class="kn">from</span> <span class="nn">pyomo.opt</span> <span class="kn">import</span> <span class="n">SolverFactory</span>
<span class="kn">import</span> <span class="nn">pyomo.environ</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">environ</span>
<span class="n">solver_manager</span> <span class="o">=</span> <span class="n">SolverManagerFactory</span><span class="p">(</span><span class="s1">&#39;neos&#39;</span><span class="p">)</span>
<span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NEOS_EMAIL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;email@address&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver_manager</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;minos&#39;</span><span class="p">)</span>

<span class="c1">#display E.l, b.l;</span>

<span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>      
</code></pre></div></td></tr></table></div>
<h3 id="cnls_concretemodel">CNLS_ConcreteModel<a class="headerlink" href="#cnls_concretemodel" title="Permanent link">&para;</a></h3>
<p>We also prepare a concrete model that does not need to call any of our developed functions in the pyStoNED package.
In this concrete model, one can define the parameter specification by reading data from an Excel file.</p>
<p><a href="https://colab.research.google.com/github/ds2010/pyStoNED/blob/master/notebooks/CNLS_ConcreteModel.ipynb">A concreteModel for CNLS estimation</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># Import packages</span>
<span class="kn">import</span> <span class="nn">pd</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Sets</span>
<span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;i</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">90</span><span class="p">)])</span>
<span class="n">model</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;DMUs&#39;</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;j1&#39;</span><span class="p">,</span> <span class="s1">&#39;j2&#39;</span><span class="p">,</span> <span class="s1">&#39;j3&#39;</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;inputs and outputs&#39;</span><span class="p">)</span>

<span class="c1"># alias</span>
<span class="n">model</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">SetOf</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> 

<span class="c1"># Parameters </span>
<span class="c1"># output (y1,y2,y3), avaiable at https://raw.githubusercontent.com/ds2010/pyStoNED/master/pystoned/data/electricityFirms.csv.</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;y.xlsx&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Dict1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df1</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">df1</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">Dict1</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="n">Dict1</span><span class="p">)</span> 

<span class="c1"># input (cost)</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;x.xlsx&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">Dict2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df2</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">Dict2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;TOTEX&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
<span class="n">model</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">initialize</span> <span class="o">=</span> <span class="n">Dict2</span><span class="p">)</span> 

<span class="c1">#Variables</span>
<span class="n">model</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;beta-coeff&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">e</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;res&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">f</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="kc">None</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;frontier&#39;</span><span class="p">)</span>

<span class="c1"># Constraints and objective f.</span>
<span class="k">def</span> <span class="nf">qreg_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">log</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">log</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">qreg</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">qreg_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;log-transformed regression&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">qlog_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">f</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">model</span><span class="o">.</span><span class="n">qlog</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">qlog_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;cost function&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">qconcav_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">qconcav</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">h</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">qconcav_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;concavity constraint&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">objective_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">objective_rule</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Define objective function&#39;</span><span class="p">)</span>

<span class="c1">#Solve the model</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">environ</span>
<span class="n">solver_manager</span> <span class="o">=</span> <span class="n">SolverManagerFactory</span><span class="p">(</span><span class="s1">&#39;neos&#39;</span><span class="p">)</span>
<span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NEOS_EMAIL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;email@address&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver_manager</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;knitro&#39;</span><span class="p">,</span> <span class="n">tee</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">#retrive the beta</span>
<span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">b</span><span class="p">[:,:]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="p">[</span> <span class="n">i</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span> <span class="n">val</span><span class="p">)]</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">df_b</span><span class="p">)</span>
<span class="c1"># display beta coefficients</span>
<span class="n">df_b</span>

<span class="n">df_b</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df_b</span><span class="p">,</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="s1">&#39;Key&#39;</span><span class="p">,</span> <span class="s1">&#39;Value&#39;</span><span class="p">])</span>
<span class="n">df_b</span> <span class="o">=</span> <span class="n">df_b</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;Key&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="c1"># retrive the residuals</span>
<span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">)</span>
<span class="n">val</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">e</span><span class="p">[:]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
<span class="n">df_e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<span class="c1">#display residuals</span>
<span class="n">df_e</span>
</code></pre></div></td></tr></table></div>
<h3 id="dea_concretemodel">DEA_ConcreteModel<a class="headerlink" href="#dea_concretemodel" title="Permanent link">&para;</a></h3>
<p>We also prepare a concrete model that 
can be used to calculate the input oriented VRS model.</p>
<p><a href="https://colab.research.google.com/github/ds2010/pyStoNED/blob/master/notebooks/DEA_ConcreteModel.ipynb">A ConcreteModel for DEA estimation</a>:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="c1"># import PYOMO package</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
<span class="c1"># creat a concrete model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>

<span class="c1"># Sets</span>
<span class="n">model</span><span class="o">.</span><span class="n">i</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;i1&#39;</span><span class="p">,</span> <span class="s1">&#39;i2&#39;</span><span class="p">,</span><span class="s1">&#39;i3&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">,</span><span class="s1">&#39;i5&#39;</span><span class="p">,</span> <span class="s1">&#39;i6&#39;</span><span class="p">,</span><span class="s1">&#39;i7&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">,</span><span class="s1">&#39;i9&#39;</span><span class="p">,</span> <span class="s1">&#39;i10&#39;</span><span class="p">],</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;DMUs&#39;</span><span class="p">,</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">j</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;CAPEX&#39;</span><span class="p">])</span>   <span class="c1"># inputs</span>
<span class="n">model</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">Set</span><span class="p">(</span><span class="n">initialize</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">])</span>   <span class="c1">#outputs</span>

<span class="c1"># Alias</span>
<span class="n">model</span><span class="o">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">SetOf</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> 

<span class="c1"># Parameters (define and import the input-output data)</span>
<span class="n">inputdata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i1&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">681</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i2&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">559</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i3&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">836</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">7559</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i5&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">424</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i6&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">1483</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i7&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">658</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">1433</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i9&#39;</span><span class="p">)</span> <span class="p">:</span>   <span class="mi">850</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;OPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i10&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">1155</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i1&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">729</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i2&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">673</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i3&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">851</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">8384</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i5&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">562</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i6&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">1587</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i7&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">570</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">1311</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i9&#39;</span><span class="p">)</span> <span class="p">:</span>  <span class="mi">564</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;CAPEX&#39;</span><span class="p">,</span> <span class="s1">&#39;i10&#39;</span><span class="p">):</span>  <span class="mi">1108</span><span class="p">,</span>
                <span class="p">}</span>
<span class="n">model</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">inputdata</span><span class="p">)</span>

<span class="n">outputdata</span> <span class="o">=</span> <span class="p">{</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i1&#39;</span><span class="p">):</span>   <span class="mi">75</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i2&#39;</span><span class="p">):</span>   <span class="mi">62</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i3&#39;</span><span class="p">):</span>   <span class="mi">78</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">):</span>   <span class="mi">683</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i5&#39;</span><span class="p">):</span>   <span class="mi">27</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i6&#39;</span><span class="p">):</span>   <span class="mi">295</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i7&#39;</span><span class="p">):</span>   <span class="mi">44</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">):</span>   <span class="mi">171</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i9&#39;</span><span class="p">):</span>   <span class="mi">98</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Energy&#39;</span><span class="p">,</span> <span class="s1">&#39;i10&#39;</span><span class="p">):</span>  <span class="mi">203</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i1&#39;</span><span class="p">):</span>   <span class="mi">878</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i2&#39;</span><span class="p">):</span>   <span class="mi">964</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i3&#39;</span><span class="p">):</span>   <span class="mi">676</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">):</span>   <span class="mi">12522</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i5&#39;</span><span class="p">):</span>   <span class="mi">697</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i6&#39;</span><span class="p">):</span>   <span class="mi">953</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i7&#39;</span><span class="p">):</span>   <span class="mi">917</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">):</span>   <span class="mi">1580</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i9&#39;</span><span class="p">):</span>   <span class="mi">116</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Length&#39;</span><span class="p">,</span> <span class="s1">&#39;i10&#39;</span><span class="p">):</span>  <span class="mi">740</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i1&#39;</span><span class="p">):</span><span class="mi">4933</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i2&#39;</span><span class="p">):</span><span class="mi">6149</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i3&#39;</span><span class="p">):</span><span class="mi">6098</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i4&#39;</span><span class="p">):</span><span class="mi">55226</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i5&#39;</span><span class="p">):</span><span class="mi">1670</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i6&#39;</span><span class="p">):</span><span class="mi">22949</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i7&#39;</span><span class="p">):</span><span class="mi">3599</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i8&#39;</span><span class="p">):</span><span class="mi">11081</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i9&#39;</span><span class="p">):</span><span class="mi">377</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s1">&#39;i10&#39;</span><span class="p">):</span><span class="mi">10134</span><span class="p">,</span>
                <span class="p">}</span>
<span class="n">model</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">Param</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">initialize</span><span class="o">=</span><span class="n">outputdata</span><span class="p">)</span>  

<span class="c1"># Variables</span>
<span class="n">model</span><span class="o">.</span><span class="n">lamda</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">io</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;envelopment efficiency&#39;</span><span class="p">)</span> 
<span class="n">model</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">io</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;intensity variable&#39;</span><span class="p">)</span> 

<span class="c1"># objective</span>
<span class="k">def</span> <span class="nf">objective_rule</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">io</span><span class="p">]</span> <span class="k">for</span> <span class="n">io</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">io</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">objective</span> <span class="o">=</span> <span class="n">Objective</span><span class="p">(</span><span class="n">rule</span><span class="o">=</span><span class="n">objective_rule</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="n">minimize</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;Define objective function&#39;</span><span class="p">)</span>       
<span class="c1"># Constraints</span>
<span class="k">def</span> <span class="nf">output_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">lamda</span><span class="p">[</span><span class="n">io</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">model</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="n">io</span><span class="p">]</span>
<span class="n">model</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">io</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">output_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;output constraints&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">input_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">theta</span><span class="p">[</span><span class="n">io</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">io</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="nb">sum</span><span class="p">(</span>
             <span class="n">model</span><span class="o">.</span><span class="n">lamda</span><span class="p">[</span><span class="n">io</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">input</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">io</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">j</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">input_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;input constraints&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">vrs_rule</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">io</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">lamda</span><span class="p">[</span><span class="n">io</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">model</span><span class="o">.</span><span class="n">vrs</span> <span class="o">=</span> <span class="n">Constraint</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">io</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">vrs_rule</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="s1">&#39;VRS constraints&#39;</span><span class="p">)</span>

<span class="c1"># calculate the DEA model </span>
<span class="kn">from</span> <span class="nn">pyomo.opt</span> <span class="kn">import</span> <span class="n">SolverFactory</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">environ</span>
<span class="n">solver_manager</span> <span class="o">=</span> <span class="n">SolverManagerFactory</span><span class="p">(</span><span class="s1">&#39;neos&#39;</span><span class="p">)</span>
<span class="n">environ</span><span class="p">[</span><span class="s1">&#39;NEOS_EMAIL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;email@address&#39;</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">solver_manager</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="s1">&#39;cplex&#39;</span><span class="p">)</span>

<span class="c1"># display the estimates</span>
<span class="c1"># efficiency</span>
<span class="n">model</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
<span class="c1"># intensity</span>
<span class="n">model</span><span class="o">.</span><span class="n">lamda</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>

  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      2023-03-07
    
  </small>
</div>





                

              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>